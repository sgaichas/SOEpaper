---
title: "State of the Ecosystem: So What? Improving ecosystem reporting for fisheries managers in the Northeast US"
author:
- name: Sarah K. Gaichas*, Sean Hardison, Sean Lucey, Scott Large  
  affiliation: NOAA NMFS Northeast Fisheries Science Center, Woods Hole, MA, USA
- name: everyone else
  affiliation: placeholder, USA
date: '`r format(Sys.Date(), "%B %d, %Y")`'
abstract: |
  Understanding the context of ecosystem status and trends is important for making informed natural resource management decisions. However, many fishery management systems are fully occupied with decisions at the species or stock level, and busy managers are reluctant to consider extensive reports with unfamiliar information if the connection to current management decisions and objectives are unclear. Here, we describe the process used to develop streamlined ecosystem reporting to meet management needs in two US fishery management regions, New England and the Mid-Atlantic. A multi-disciplinary team was assembled to revise an initial report that had been based on a format used in another US region. First, ecosystem indicators were clearly aligned with stated fishery management objectives. Second, objectives and associated indicators relating to human well-being (e.g., seafood production) were placed first in the report, rather than last. Third, standardized visualizations were used for time series and maps. Finally, reports used transparent and reproducible production methods to meet management deadlines. Engagement with managers is ongoing to further improve the utility of the report. This approach to streamlined, audience-specific ecosystem reporting is flexible and adaptable to many different governance contexts, and can be used to provide information essential to implement ecosystem based management.  
keywords: ecosystem approach, natural resource management, fisheries, integrated ecosystem assessment, ecosystem indicators, economic indicators, management objectives
bibliography: SOE.bib
output: 
  bookdown::pdf_book:
    includes:
      in_header: riskassess-preamble-latex.tex
    base_format: rticles::plos_article
csl: plos.csl    
---

*add names from SOE acknowledgements:*
*- name: Donald Anderson, Amani Bassyouni, Lisa Calvo, Lisa Colburn, Geret DePiper, Deb Duarte, Kevin Friedland, Heather Haas, Mike Hammil, Kimberly Hyde, Loren Kellogg, Kristin Kleisner, Dave Kulis, Chris Melrose, Ryan Morse, Kimberly Murray, Chris Orphanides, Charles Perretti, Karl Roscher, Vincent Saba, Laurel Smith, Mark Terceiro, John Walden, Harvey Walsh, Mark Wuenschel*
*add Mike Fogarty and graphic artist for conceptual models*
*affiliation: NEFSC and other places, need to sort out, USA*


```{r Directory and Data Set-up, echo=F, message=F, warning=FALSE, paged.print=TRUE}

 data.dir  <- './data'
 image.dir <- './images'
 gis.dir <- './usa_shape_files'

#STOP HERE
#Do you have the most updated version of the SOE.data.2018 dataset AND the necessary spatial data? Check the SOE_MAB google drive for most recent version.


load(file.path(data.dir, "SOE_data_2018.Rdata"))
# latex figure folder
knitr::opts_chunk$set(echo = FALSE, fig.path = './iea_figs_ne/')

#The map_figs option can be set to FALSE to skip making maps on the fly (they will be missing). Or TRUE to make them. 
map_figs <- T

```

```{r libraries, echo=F, message=F, warning=FALSE, paged.print=TRUE, results = 'hide'}
library(Kendall);library(data.table);library(zoo)
library(dplyr);library(nlme);library(AICcmodavg)
library(colorRamps);library(Hmisc);library(rgdal)
library(maps);library(mapdata);library(raster)
library(grid);library(stringr);library(png)
library(ncdf4);library(marmap); library(magick);
library(knitr); library(readr); library(kableExtra);
library(multipanelfigure)


#get map data and set constants
#projection
map.crs <- CRS("+proj=longlat +lat_1=35 +lat_2=45 +lat_0=40 +lon_0=-77 +x_0=0
               +y_0=0 +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0")

#coastline and bathymetry
coast <- readOGR(gis.dir, 'NES_LME_coast', verbose = F)
coast <- spTransform(coast,map.crs)
bathy <- raster('NES_bathymetry.tif')

#define extents for cropping
e  <- extent(-77.2, -64.2, 35, 48)
th_extent <-extent(-77,-65,35,45) #thermal habitat

#crop - thermal habitat bathymetry before general bathymetry
coast <- crop(coast, e)
th <- crop(bathy,th_extent)
bathy <- crop(bathy, e)

#projections
projection(th) <- map.crs
projection(bathy) <- map.crs

#get strata files to clip thermal habitat projections
strata <- readOGR(gis.dir,"strata", verbose = F)
strata@proj4string <- map.crs
```


```{r libraries and functions, include=F, echo = F}
options(repos = c(CRAN = "http://cran.rstudio.com"))


fit_lm <- function(dat) {
  # Remove missing values first so that all models
  # use the same number of observations (important for AIC)
  # dat <- dat %>% dplyr::filter(complete.cases(.))
  
  # Constant model (null model used to calculate 
  # overall p-value)
  constant_norm <-
    nlme::gls(series ~ 1, 
              data = dat)
  
  constant_ar1 <-
    try(nlme::gls(series ~ 1,
                  data = dat,
                  correlation = nlme::corAR1(form = ~time)))
  if (class(constant_ar1) == "try-error"){
    return(best_lm <- data.frame(model = NA,
                                 aicc  = NA,
                                 coefs..Intercept = NA,
                                 coefs.time = NA,
                                 coefs.time2 = NA,
                                 pval = NA)) 
  } 
  
  
  
  # Linear model with normal error
  linear_norm <- 
    nlme::gls(series ~ time, 
              data = dat)
  
  # Linear model with AR1 error
  linear_ar1 <- 
    try(nlme::gls(series ~ time, 
                  data = dat,
                  correlation = nlme::corAR1(form = ~time)))
  if (class(linear_ar1) == "try-error"){
    return(best_lm <- data.frame(model = NA,
                                 aicc  = NA,
                                 coefs..Intercept = NA,
                                 coefs.time = NA,
                                 coefs.time2 = NA,
                                 pval = NA))
    
  }
  
  # Polynomial model with normal error
  dat$time2 <- dat$time^2
  poly_norm <- 
    nlme::gls(series ~ time + time2, 
              data = dat)
  
  # Polynomial model with AR1 error
  poly_ar1 <- 
    try(nlme::gls(series ~ time + time2, 
                  data = dat,
                  correlation = nlme::corAR1(form = ~time)))
  if (class(poly_ar1) == "try-error"){
    return(best_lm <- data.frame(model = NA,
                                 aicc  = NA,
                                 coefs..Intercept = NA,
                                 coefs.time = NA,
                                 coefs.time2 = NA,
                                 pval = NA))
    
  }
  
  # Calculate AICs for all models
  df_aicc <-
    data.frame(model = c("poly_norm",
                         "poly_ar1",
                         "linear_norm",
                         "linear_ar1"),
               aicc  = c(AICc(poly_norm),
                         AICc(poly_ar1),
                         AICc(linear_norm),
                         AICc(linear_ar1)),
               coefs = rbind(coef(poly_norm),
                             coef(poly_ar1),
                             c(coef(linear_norm), NA),
                             c(coef(linear_ar1),  NA)),
               # Calculate overall signifiance (need to use
               # ML not REML for this)
               pval = c(anova(update(constant_norm, method = "ML"),
                              update(poly_norm, method = "ML"))$`p-value`[2],
                        anova(update(constant_ar1, method = "ML"),
                              update(poly_ar1, method = "ML"))$`p-value`[2],
                        anova(update(constant_norm, method = "ML"),
                              update(linear_norm, method = "ML"))$`p-value`[2],
                        anova(update(constant_ar1, method = "ML"),
                              update(linear_ar1, method = "ML"))$`p-value`[2]))
  
  best_lm <-
    df_aicc %>%
    dplyr::filter(aicc == min(aicc))
  
  
  if (best_lm$model == "poly_norm") {
    model <- poly_norm
  } else if (best_lm$model == "poly_ar1") {
    model <- poly_ar1
  } else if (best_lm$model == "linear_norm") {
    model <- linear_norm
  } else if (best_lm$model == "linear_ar1") {
    model <- linear_ar1
  }
  
  return(list(p = best_lm$pval,
              model = model))
}


#Plot new figure - Set end.start to 10 years before end of time series

soe.plot <- function(data, x.var, y.var, x.label = '', y.label = '', tol = 0.1,
                     x.start = NA, x.end = NA, end.start = 2008, bg.col = background, mean_line = T,
                     end.col = recent, stacked = NA, x.line = 2.5, y.line = 3.5, scale.axis = 1,
                     rel.y.num = 1.5, rel.y.text = 1.5, rel.x.text = 1, rel.x.num = 1,
                     suppressAxis = FALSE, status  = F, anomaly = F,
                     endshade = TRUE, full.trend = TRUE, point.cex = 1.5, lwd = 2, ymax = TRUE,ymin = TRUE,
                     y.upper = y.upper, y.lower = y.lower, extra = FALSE, x.var2 = x.var2, y.var2 = y.var2,
                     line.forward = FALSE, mean_line.2 = T, cex.stacked = 1) {
  
  #print("You'll need to remove or interpolate NA values before this function will work")
  
  #Select Data
  x <- data[Var == y.var, ]
  x <- x[order(x[, get(x.var)]), ]
  setnames(x, x.var, 'X')
  
  #Set common time step if necessary
  if(is.na(x.start)) x.start <- min(x[, X])
  if(is.na(x.end))   x.end   <- max(x[, X])
  x <- x[X >= x.start, ]
  
  #Set up plot parameters
  if (ymax == TRUE){
    y.max <- max(x[, Value]) + tol * max(x[, Value])
  } else {
    y.max <- as.numeric(y.upper)
  }
  
  if (ymin == TRUE){
    y.min <- min(x[, Value]) - tol * abs(min(x[, Value]))
  } else if (ymin == FALSE){
    y.min <- as.numeric(y.lower)
  }
  
  y.mean <- mean(x[, Value])
  y.sd <- sd(x[, Value])
  
  #Plot blank plot
  plot(x[X >= x.start, list(X, Var)], xlim = c(x.start, x.end),
       ylim = c(y.min,y.max), xlab = '', ylab = '', axes = F, ty = 'n')


  #Add background
  u <- par('usr')
  rect(u[1], u[3], u[2], u[4], border = NA, col = bg.col)
  
  #Add end period shading
  if (endshade == TRUE){
    rect(end.start - 0.5, u[3], u[2], u[4], border = NA, col = end.col)
  }
  
  #Add mean line
  if (anomaly == F){
      if (mean_line == TRUE){
      abline(h = y.mean, col = 'grey', lwd = 3, lty = 2)
      } 
  } else if (anomaly == TRUE){
      abline(h = 0, col = 'grey', lwd = 3, lty = 2)
  }
  
  #Add x y lines
  abline(h = u[3], lwd=3)
  abline(v = u[1], lwd=3)
  
  #Add data points/lines
  points(x[, list(X, Value)], pch = 16, cex = point.cex)
  lines( x[, list(X, Value)], lwd = lwd)
  
  #extra lines
  if (extra == TRUE){
    x2 <- data[Var == y.var2, ]
    x2 <- x2[order(x2[, get(x.var2)]), ]
    setnames(x2, x.var2, 'X2')
    x2 <- x2[X2 >= x.start, ]
    if (mean_line.2 == TRUE){
     abline(h = mean(x2[, Value]), col = 'lightcoral', lwd = 3, lty = 2) 
    }
    points(x2[, list(X2, Value)], pch = 16, cex = point.cex, col = "indianred")
    lines( x2[, list(X2, Value)], lwd = lwd, col = "indianred")
    }
    
  
  #Add axis
  if (suppressAxis == FALSE){
    if(is.na(stacked)) axis(1, cex.axis = rel.x.num) # SKG changed from default of 1, put rel.x.num=1 as default in function call
    if(!is.na(stacked)){
      if(stacked!= 'A') axis(3, cex.axis = 1.5, tck = 0.1, labels = F)
    }
  }

  #Stacked axes with 0 overlap so need to remove
  labels <- round((axTicks(2) / scale.axis), 5)
  if(labels[1] == 0) labels[1] <- ''
  axis(2, at = axTicks(2), labels = labels, cex.axis = rel.y.num,
       las = T)

    #Add axis labels
    if(!is.na(stacked)) text(u[1], u[4], labels = stacked, cex = cex.stacked, adj = c(-0.5, 1.5))
    if(is.na(stacked)){
      mtext(1, text = x.label, line = x.line, cex = rel.x.text) #SKG changed from hardcoded cex = 1 for x axis, added default of 1 in function call
      mtext(2, text = y.label, line = y.line, cex = rel.y.text)
    }
  
    if (full.trend == T){
    #Split data into past decade and full time series
    dat <- as.data.frame(x[, list(X, Value)])
    
    dat <- dat %>% dplyr::rename(series = Value) %>%
      mutate(time = seq(1,nrow(dat),1))
    
    # Fit linear model
    lm_out <- fit_lm(dat = dat)
    p <- lm_out$p
    if (p < .05){
        
      newtime <- seq(min(dat$time), max(dat$time), length.out=length(dat$time))
      newdata <- data.frame(time = newtime,
                      time2 = newtime^2)
      lm_pred <- AICcmodavg::predictSE(lm_out$model, 
                                 newdata = newdata,
                                 se.fit = TRUE)
      
      year <- seq(x$X[1],x$X[length(x$X)],length.out = length(dat$time))

      # Make plot
      if (lm_pred$fit[length(lm_pred$fit)] > lm_pred$fit[1]){
        lines(year, lm_pred$fit, col = main.pos, lwd = 7)
        points(x[, list(X, Value)], pch = 16, cex = point.cex)
        lines( x[, list(X, Value)], lwd = lwd)

        if (line.forward == TRUE){
           lines(year, lm_pred$fit, col = main.pos, lwd = 7)
        }
      } else if (lm_pred$fit[length(lm_pred$fit)] < lm_pred$fit[1]){
        lines(year, lm_pred$fit, col = main.neg, lwd = 7)
        points(x[, list(X, Value)], pch = 16, cex = point.cex)
        lines( x[, list(X, Value)], lwd = lwd)
        if (line.forward == TRUE){
           lines(year, lm_pred$fit, col = main.neg, lwd = 7)
        }
      }
    }
    
    if (extra == TRUE){
      
      # Second variable
      dat <- as.data.frame(x2[, list(X2, Value)])
    
      dat <- dat %>% dplyr::rename(series = Value) %>%
      mutate(time = seq(1,nrow(dat),1))
    
     # Fit linear model
      lm_out <- fit_lm(dat = dat)
      p <- lm_out$p
      points(x2[, list(X2, Value)], pch = 16, cex = point.cex, col = "indianred")
      lines( x2[, list(X2, Value)], lwd = lwd, col = "indianred")
      if (p < .05){
    
        newtime <- seq(min(dat$time), max(dat$time), length.out=length(dat$time))
        newdata <- data.frame(time = newtime,
                      time2 = newtime^2)
        lm_pred <- AICcmodavg::predictSE(lm_out$model, 
                                 newdata = newdata,
                                 se.fit = TRUE)
        
        year <- seq(x2$X2[1],x2$X2[length(x2$X2)],length.out =length(dat$time))
   
    # Make plot
        if (lm_pred$fit[length(lm_pred$fit)] > lm_pred$fit[1] ){
          lines(year, lm_pred$fit, col = main.pos, lwd = 7)
          points(x2[, list(X2, Value)], pch = 16, cex = point.cex, col = "indianred")
          lines( x2[, list(X2, Value)], lwd = lwd, col = "indianred")
        } else if (lm_pred$fit[length(lm_pred$fit)] < lm_pred$fit[1]){
          lines(year, lm_pred$fit, col = main.neg, lwd = 7)
          points(x2[, list(X2, Value)], pch = 16, cex = point.cex, col = "indianred")
          lines( x2[, list(X2, Value)], lwd = lwd, col = "indianred")
        } 
     }
    }

  }


 
}  


#Add axis labels for stacked plots
soe.stacked.axis <- function(x.label, y.label, x.line = 2.5,rel.x.text = 1.5,
                             y.line = 3.5, rel.y.text = 1.5, outer = TRUE){
  axis(1, cex.axis = rel.x.text)
  mtext(1, text = x.label, line = x.line, cex = rel.x.text, outer = outer)
  mtext(2, text = y.label, line = y.line, cex = rel.y.text, outer = outer)
  
}


#Background colors
background   <- 'white'
recent       <- '#E6E6E6'
main.pos <- rgb(253/255, 184/255, 99/255,  alpha = .9)
main.neg <- rgb(178/255, 171/255, 210/255, alpha = .9)

#Finder function for quickly finding variables based on partial match
finder <- function(data, match = match, factor = T){
  found <- unique(data[grepl(match,data$Var),]$Var)
  if (factor == T){
    return(found)
  } else {
    return(as.character(found))
  }
  
}

#thermal habitat map function
#thermal habitat map function
th_plot <- function(data, letter, z.max, y.axis = T,
                    legend = T, pos){
  if (pos == 'topleft'){
    par(mar=c(3.9, 2.8,3.5,0), mex = .3,  mgp = c(4, .35, 0))
  } else if (pos == 'topright'){
    par(mar=c(3.9, 0, 3.5, 2.8), mex = .3,  mgp = c(4, .35, 0))
  } else if (pos == "bottomleft"){
    par(mar=c(3.9,2.8,3.5,0), mex = .3,  mgp = c(4, .35, 0))
  } else if (pos == "bottomright"){
    par(mar=c(3.9, 0, 3.5, 2.8), mex = .3,  mgp = c(4, .35, 0))
  }
  
  data <- nc_open(data)
  
  #longitude
  lon <- ncvar_get(data, "xi", verbose = F)
  
  #latitude
  lat <- ncvar_get(data, "yi", verbose = F)
  
  #thermal habitat projection
  z <- ncvar_get(data, "zi")
  
  #combine in data.frame
  proj <- data.frame(lon = lon,
                     lat = lat,
                     z = z)
  
  proj <- proj %>% filter(z != "NA",z>0) %>% 
    mutate(z = plyr::mapvalues(z, from = (z[(z>z.max)]), to = rep(z.max,length(z[(z>z.max)]))))
  
  #turn dataframe to raster
  coordinates(proj) = ~lon+lat
  proj4string(proj)=map.crs # set it to lat-long
  proj = spTransform(proj,map.crs)
  proj <- proj[strata,]
  gridded(proj) = TRUE
  r = raster(proj)
  projection(r) = map.crs
  
  colors <- matlab.like(120)
  #plot maps
  if (legend == T){
    plot(r, col=colors, ylim=c(35,45),
         breaks=seq(0,z.max,length.out=length(colors)),
         zlim = c(0,z.max),
         legend.width = 2,
         axes=F, interpolate = T, las = 1,box = T,
         axis.args=list(at=seq(0, z.max, length.out = 5),
                        labels=round(seq(0,1,length.out = 5),1), 
                        cex.axis=0.8),
         legend.args=list(text=expression(paste("     Thermal \n      Habitat")),
                          side=3, font=2, line=1, cex=.65))
  } else {
    plot(r, col=colors, ylim=c(35,45),
         breaks=seq(0,z.max,length.out=length(colors)),
         axes=F, interpolate = F, las = 1,box = T,legend = F)
  }
  
  
  map("worldHires", xlim=c(-77,-65),ylim=c(35,45), fill=T,border=0,col="gray", add = T)
  
  if (y.axis == T){
    map.axes(cex.axis = .7)
  } else if (y.axis == F){
    axis(1,cex = .7)
    box(lty = 'solid', col = 'black',lwd = 1)
  }
  
  
  contour(th,drawlabels = F,nlevels = 2,add=T, col = "gray20",lty=2, lwd = .5)
  text(-75.5, 43.9, letter,cex = 1.5)
  
}


```


# Introduction
As national and international policy increasingly calls for ecosystem-based management of natural resources, it is important for decision-makers to understand the current status and recent trends of key ecosystem attributes. For example, an ecosystem in a high productivity state may withstand extractive activities better than the same ecosystem in a low productivity state. 

* EBFM sounds hard but it doesnt have to be, here is an example of ecosystem reporting that is useful to managers and how we did it.  Initial drafts followed a format used in another region but managers wanted to know "so what". Here is how we addressed this to produce two relatively automated reports that Councils are now requesting annually. lessons learned could serve as example for other ecosystem reporting efforts.

# Methods
* build on existing efforts inside and outside the region; ESRs, SOE west coast
* address OBJECTIVES, clearly align indicators with objectives (IEA process, WGNARS)
* conceptual model links environmental drivers, ecosystem components, human activities, and objectives
* put most manager-relevant things first: HUMAN DIMENSIONS instead of salinity, etc
* keep it short, <25 printed pages
* keep language non-technical, don't include references etc in report
* publish technical methods separately for those that are interested (see [supplement](https://noaa-edab.github.io/tech-memo/); Technical methods as individual rmarkdown documents rolled up into one bookdown.)
produce in Rmarkdown for reproducibility and ease of conversion to different reports
* data in standardized format with standardized plotting
* version control on github
* production process: first years, one lead asking for data from multiple people, inefficient. 2017: workshop to develop outline in August with managers to focus further, smaller working groups (human dimensions, protected species, etc) developing new section until December, when data were needed. Mid-January 2018 synthesis meeting, report production Feb, internal review, revision, and to initial Council review early March 2018.
present to the Council SSC (Mid) first for initial review, turn around for full Council presentation in ~1 month responding as possible to review, responding to previous year's comments explicitly
Councils receive reports in April of each year, main message is whether there are big changes in the ecosystem or other threats to achieving their objectives

# Results
The results of this process were the full [Mid-Atlantic State of the Ecosystem 2018](http://www.mafmc.org/s/Tab04_State-of-the-Ecosystem-Apr2018.pdf) and
[New England State of the Ecosystem 2018](https://s3.amazonaws.com/nefmc.org/2_Ecosystem-Status-Report.pdf) reports delivered in April 2018, which are posted as part of the public record on each Fishery Management Council's website. Here, we highlight key aspects and findings of the reports that arose from the multidiscplinary approach. We reproduce the leading pages of the Mid-Atlantic report as an example below, demonstrating the use of conceptual models, place-based spatial units, and alignment of ecosystem indicators with management objectives. Key messages were highlighted in **boldface**, with relevant tables and figures immediately adjacent to the text. 

## SOE Report Introduction
>The purpose of this report is to provide **ecosystem-scale information for fishery managers** to consider along with existing species-scale analyses.  An overview of ecosystem relationships as represented by **a conceptual model helps place more detailed species-level management in context** by highlighting relationships between focal species groups organized by Mid Atlantic Fishery Management Council (MAFMC) Fishery Management Plan (FMP), managed human activities, environmental drivers, habitats, and key ecological links (Fig. \@ref(fig:conceptual). Here, human activities link to high level strategic management objectives. Many components of the conceptual model are represented by indicators in this report, and key paths connecting components and objectives are highlighted.

## SOE Report Executive Summary
>We have organized this report using a proposed set of **ecosystem-scale objectives** derived from US legislation and current management practices (Table \@ref(tab:objcatsMAB)). We report indicators at the spatial scale of either the Mid-Atlantic Bight (MAB; Fig. \@ref(fig:map)), for Mid Atlantic states, or Northeast US coastwide where appropriate. Indicator spatial scale is noted in each section heading. 

```{r objcatsMAB, echo=FALSE, message=FALSE, warning=FALSE}
tabl <- "
|Objective Categories|Indicators Reported Here|
|:-------------------------|:----------------------------------------------------------|
| Seafood production       | Landings by feeding guild, mariculture                    |
| Profits                  | Revenue by feeding guild                                  |
| Recreation               | Number of anglers and trips; recreational catch           |
| Stability                | Diversity indices (fishery and species)                   |
| Social-Cultural          | Commercial and recreational reliance; social vulnerability|
| Biomass                  | Biomass or abundance by feeding guild from surveys        |
| Productivity             | Condition and recruitment of MAFMC managed species        |
| Trophic structure        | Relative biomass of feeding guilds, primary productivity  |
| Habitat                  | Thermal habitat projections, estimated habitat occurrence |
"
#cat(tabl) # output the table in a format good for HTML/PDF/docx conversion

df<-read_delim(tabl, delim="|")
df<-df[-c(1,2) ,c("Objective Categories","Indicators Reported Here")]
knitr::kable(
  df, booktabs = TRUE,
  caption = 'Ecosystem-level management objectives.'
)
```


### Synthesis of single species status in executive summary
>**We also report single-species status relative to established objectives and reference points**. The Mid Atlantic Council (MAFMC) is meeting objectives at the managed species (stockwide) level for fishing mortality (F) rates for 8 of 15 stocks and biomass (B) levels for 11 of 15 stocks relative to established reference points (Fig. \@ref(fig:KOBE)). The exceptions include high F rates for summer flounder and Atlantic mackerel, low B status for Atlantic mackerel, and likely high F rates for blueline tilefish. Three stocks (*Illex* squid, Northern and Southern monkfish) have unknown status for both F and B, blueline tilefish for B, and longfin squid have unknown F status.

### Synthesis across ecosystem indicators in executive summary
>**Performance against human dimensions objectives is mixed, with declines in seafood production and recreational opportunities but stabilization of fleet numbers and revenue diversity.**  Revenue has seen substantial 
interannual variability in recent years, driven primarily by increases in prices of benthos (i.e. scallops & clams). Total volume of landings have decreased since at least 2010, with seafood production by both commercial and recreational fisheries declining overall. This corresponds to a stark decrease in recreational fishing effort and participation since 2008, although the number of commercial fleets, and the diversity of revenue generated from those fleets, have been relatively stable in the last few years. The diversity of species revenue, measured at the individual permit level, has also been relatively stable over the past 10 years. However, many communities in the Mid-Atlantic Bight (MAB) that are highly engaged and/or reliant on commercial fishing are socially vulnerable, and **5 of the 6 largest commercial fishing ports in the MAB (in terms of revenue) are heavily dependent on benthic species which are in turn highly vulnerable to climate change.**
>
>**Fisheries are currently meeting objectives with respect to protected species bycatch reduction, but climate and ecosystem changes may upset this balance.** Fisheries interactions with harbor porpoise have decreased due to management measures, but climate driven distribution changes for sea turtles may lead to future fishery interactions and potential regulations. In addition, the most endangered species in the system (North Atlantic right whale) may be declining over the most recent few years after a slow but steady increase. **Ecosystem conditions combined with changing distributions may be contributing to the decline and observed unusual mortality event for right whales in 2017.**
>
>**Biomass of resource species changes seasonally in this dynamic system.**  Survey biomass trends for aggregated trophic groups of resource species differ in the fall and spring. Larval survey data indicates species diversity has increased in the spring, but no similar shift has been witnessed in the fall. At the lowest trophic level, benthos, including commercial shellfish, show long term increases in both seasons. In contrast, piscivores at higher trophic levels have conflicting long term trends depending on the season sampled. Seasonally divergent aggregate trends require further investigation.
>
>**Additional indicators in this report suggest a note of caution for the aggregate productivity of fish species in the region** (fish condition declined and recovered for some species while survey based aggregate “recruitment” has declined overall). These changes in fish productivity may be linked to observed patterns in plankton communities, to changes in habitat, or both.  While there are some long-term productivity trends at the bottom of the food web in the Mid Atlantic, changes in species composition and shifts in seasonal timing may have a greater impact on upper trophic levels. Temperature is increasing in long term sea surface records as well as surface and bottom measurements from surveys. The seasonal temperature signal also shows sustained warming. **Warming waters have impacts on the ecosystem that can be complex due to differential impacts at the species level, including observed shifts in species distribution and changes in productivity as thermal habitats shift.** 

The main body of the report follows the executive summary with more detail on the indicator results. The full set of report sections and includes indicators of fishery performance, human community vulnerability, fishery interactions with protected species, resource species trends, and ecosystem consitions and productivity (Table \@ref(tab:SOEcontents)). Many indicators aggregate species by similar functional groups (Table \@ref(tab:speciesgroupingsMAB)). 

```{r SOEcontents, echo=FALSE, message=FALSE, warning=FALSE}

SOEcont <- read.csv(file.path(data.dir,"indicatortable.csv"))
knitr::kable(SOEcont, format = "latex", booktabs = T, caption = 'Report sections, indicators, and scale of information.') %>%
  kable_styling(font_size=10, latex_options=c("repeat_header", "scale_down")) %>%
  column_spec(1, width="3cm") %>%
  column_spec(2:3, width="7cm") %>%
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle")

```


```{r speciesgroupingsMAB, echo=FALSE, message=FALSE, warning=FALSE}
tabl <- "
|Group|N species|Major species in the group|
|:------------------|:-------|:--------------------------------------------|
| A: **Apex predator** (Highest trophic level)   |  4  | shark (Unc.), swordfish, yellowfin and bluefin tuna |
| B: **Piscivore** (Eat fish)                    |  23 | spiny dogfish, summer flounder, bluefish, striped bass, weakfish, monkfish, winter and thorny skates, silver and offshore hake, Atlantic cod and halibut, fourspot flounder |
| C: **Planktivore** (Eat plankton)              |  16 | Atlantic and blueback herring, alewife, shad, menhaden, cusk, Atlantic mackerel, butterfish, blackbelly rosefish, sculpins, lumpfish, northern searobin, northern sand lance, northern shortfin and longfin squid |
| D: **Benthivore** (Eat bottom dwellers)       |  25 | black sea bass, scup, tilefish, tautog, cunner, blue crab, red crab, lobster, ocean pout, haddock, yellowtail, winter, and witch flounders, barndoor skate, American plaice, other crabs|
| E: **Benthos**  (Filter feeders)               |  9  |  scallops, surfclam, quahog, mussels, whelks, conchs, sand dollars and urchins |
"
#cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
df<-read_delim(tabl, delim="|")
df<-df[-c(1,2) ,c("Group","N species", "Major species in the group")]
knitr::kable(df, booktabs = TRUE, caption = 'Feeding guilds (formatted for Mid-Atlantic report).') %>%
  kable_styling(font_size=10, latex_options=c("repeat_header", "scale_down")) %>%
  column_spec(1, width="6cm") %>%
  column_spec(2, width="2cm") %>%
  column_spec(3, width="7.5cm") #%>%
  #collapse_rows(columns = 1, latex_hline = "major", valign = "middle")

```

Below we give illustrative examples of SOE reporting from the main body of the report. In the first, we demonstrate how reporting of the same indicator suite was tailored for a single ecological production unit (Mid-Atlantic) and for two ecological production units within one management jurisdiction (New England). This was the first in-depth indicator discussion in each report following the executive summary.

## Human dimensions objectives first

### Seafood production (MAB)
>Seafood production is a stated goal of optimal fishery management as part of the definition of “benefits to the nation” under MSA. Both commercial and recreational fishing contributes to seafood production, the latter for personal consumption, and indicators for each of these human activities track management performance against this objective. 
>
>The MAFMC only manages a portion of the total commercial landings that occur in the MAB region.  For example, blue crabs represent a substantial portion of category D (Benthivores) landings (Table \@ref(tab:proplandingsrevMAB)). Therefore in 2016, MAFMC accounted for 15% of the Benthivore landings and 12% of the revenue generated from those landings in the MAB.

```{r proplandingsrevMAB, echo=FALSE, message=FALSE, warning=FALSE}
tabl <- "
|Groups|MAB Landings|MAB Revenue|
|:----------------|:------------|:-----------|
| Piscivore       | 0.16        | 0.50       |
| Planktivore     | 0.64        | 0.93       |
| Benthivore      | 0.15        | 0.12       |
| Benthos         | 0.62        | 0.10       |
"
#cat(tabl) # output the table in a format good for HTML/PDF/docx conversion

df<-read_delim(tabl, delim="|")
df<-df[-c(1,2) ,c("Groups","MAB Landings", "MAB Revenue")]
knitr::kable(
  df, booktabs = TRUE,
  caption = 'Proportion of landings and revenue derived from managed species in the Mid-Atlantic region.'
)
```
>
>Figure \@ref(fig:seafoodlandingsMAB) shows the removals for human consumption of trophic groups including both all species landed in the MAB as well as the subset of those removals managed by the MAFMC.  Landings for managed species are all trending up in recent years, but only Benthivore landings are above the long term-mean. There is a significant decline in MAFMC-managed landings of benthos. We note that time series at the Mid-Atlantic regional scale may not include all state landings prior to 1994.
>
>Total commercial seafood landings from all species and from MAFMC managed species in the MAB indicate total seafood production. Years prior to 1977 included foreign landings, so we begin the time series in 1986. Recent landings are all domestic fisheries. Looking across all regions, there is a significant recent decrease in seafood landings, indicating high risk to regional domestic seafood production. 
>
>Recreational seafood landings (as opposed to total landings which include catch and release that are captured under other risk elements/indicators) were used to assess food use of recreationally caught fish in the Mid-Atlantic.


### Seafood production (GOM and GB)
>Seafood production is a stated goal of optimal fishery management as part of the definition of “benefits to the nation” under MSA. Both commercial and recreational fishing contributes to seafood production, the latter for personal consumption, and indicators for each of these human activities track management performance against this objective.  
>
Commercial landings include all seafood landings in the region, including species not managed by NEFMC. For example, category D, Benthivores, includes lobsters, which are a substantial portion of the landings and drive increases in landings and revenue. In 2016, NEFSC managed stocks made up from 5%-98% of total landings by category, as detailed below (Table \@ref{tab:proptableNE}). 

```{r proptableNE, echo = F, message=FALSE, warning=FALSE}
#Use this to create table of proportion of landings/revenue derived from NEFMC species (stargazer produces latex. Set eval = F)
#library(stargazer)
#convert to kable
gom_landings <- SOE.data.2018[grepl("GOM Landings 2016", SOE.data.2018$Var),]$Value
gom_landings <- gom_landings[c(1,3,2,4)]
joint_gom_landings <- SOE.data.2018[grepl("GOM Joint Landings 2016", SOE.data.2018$Var),]$Value
joint_gom_landings <- joint_gom_landings[c(1,3,2,4)]

gb_landings <- SOE.data.2018[grepl("GB Landings 2016", SOE.data.2018$Var),]$Value
gb_landings <- gb_landings[c(1,3,2,4)]

joint_gb_landings <- SOE.data.2018[grepl("GB Joint Landings 2016", SOE.data.2018$Var),]$Value
joint_gb_landings <- joint_gb_landings[c(1,3,2,4)]

gom_revenue <- SOE.data.2018[grepl("GOM Revenue 2016", SOE.data.2018$Var),]$Value
joint_gom_revenue <- SOE.data.2018[grepl("GOM Joint Revenue 2016", SOE.data.2018$Var),]$Value
gom_revenue <- gom_revenue[c(1,3,2,4)]

gb_revenue <- SOE.data.2018[grepl("GB Revenue 2016", SOE.data.2018$Var),]$Value
joint_gb_revenue <- SOE.data.2018[grepl("GB Joint Revenue 2016", SOE.data.2018$Var),]$Value
joint_gom_revenue <- joint_gom_revenue[c(1,3,2,4)]

df <- data.frame(Groups = c("Piscivore","Planktivore","Benthivore","Benthos"),
                 gom_landings = gom_landings+joint_gom_landings,
                 gb_landings = gb_landings+joint_gb_landings,
                 
                 gom_revenue = gom_revenue + joint_gom_revenue,
                 gb_revenue = gb_revenue + joint_gb_revenue)
                 

names(df) <- c("Groups", "GOM Landings", "GB Landings", "GOM Revenue",
                "GB Revenue")

kable(df, booktabs = TRUE, digits=2, caption = "Proportion managed by NEFMC")
#stargazer(df, summary = F, rownames = T, title = "Proportion of catch managed by NEFMC (2016)", header = F)
```
>
Figure \ref{fig:seafoodlandingsGOM} shows the removals for human consumption both at the entire EPU level as well as those removals managed by the NEFMC. Landings of piscivores have decreased over the long term in both systems. Benthos landings show no long term trends in either system. Other groups have a decreasing landings trend in either GOM or GB.
>
Total commercial seafood landings from all species and from NEFMC managed species indicate total seafood production in the GOM and GB, which has declined over the long term (Fig. \ref{fig:managedlandingsNE}). 
>
Recreational seafood landings (as opposed to total landings which include catch and release that are captured under other risk elements/indicators) were used to assess food use of recreationally caught fish. This trend is also declining (Fig. \ref{fig:reccatchNE}). 

## Synthesis across indicators within a section


# Discussion
* Rising to the "so what" challenge improved ecosystem reporting in the NE US and has resulted in other analyses of use to managers (e.g. ref risk assessment, hopefully published by then). An effective annual process has evolved where contextual information is presented that can change multiple decisions if necessary (ref Zador, value of qualitative information). Flexibility and responsiveness to audience important, willing to change reporting as manager needs change.
* Focus on synthesis and indicators directly addressing management objectives key. Don't get rid of all other ecosystem indicators but report selectively from a "mothership" of ecosystem data (e.g. ESR on the web) for different audiences. The encyclopedic report is less useful for managers who have limited time and need the bottom line. Oceanographers want the salinity time series, fishery managers dont know what to do with them unless clearly connected to habitat of managed species or other objectives.
* Put best practices/lessons learned from IEA group WGNARS (ref DePiper et al 2017, also Levin et al 2009 other IEA lit) into actual practice.
* Automation and transparency useful not just in theory but for practical report production. Rmarkdown and github workflow efficient and traceable, allows effective collaboration. (Would be great to have SOE as html for website too and point to that)
* Next steps (in progress): web access to indicator data through ERDDAP (link), retrospective documentation of past indicators, development of new indicators. Priority given to indicator selection and evaluation, threshold analysis, synthetic methods such as DFA. Keep indicator data available and accessible for synthesis, modeling, future work.
* Process flexible and can be adjusted to needs in any region/management context. Maybe EBFM isn't so hard after all.

# References
<div id="refs"></div>

# Figures

```{r conceptual, fig.cap="Mid-Atlantic Ecosystem", fig.height=6, fig.width=4, out.width='\\linewidth', fig.align='center', echo = F, message = FALSE, warning = FALSE, eval = T}
knitr::include_graphics(file.path(image.dir, 'SOE_MAB_ConceptMod.png'))

```
\newpage

```{r map, fig.cap="Mid Atlantic Bight (MAB) spatial extent", fig.height=6, fig.width=4, out.width='0.8\\linewidth', fig.align='center', echo = F, message = FALSE, warning = FALSE, eval = T}
image_read(file.path(image.dir,"NEshelfEcoRegionsALL.png")) %>%
image_trim()

```
\newpage

```{r KOBE, fig.cap="Summary of single species status for MAFMC stocks", fig.height=7, fig.width=7, out.width='0.65\\linewidth', fig.align='center', echo = F, message = FALSE, warning = FALSE, eval = T}
#knitr::include_graphics(file.path(image.dir, 'MAFMC_joint_stocks_2017.pdf'))

dat <- read.csv(file.path(data.dir, "2017assess.csv"))

stocks <- unique(dat$Entity.Name)
n.stocks <- length(stocks)

decoder <- read.csv(file.path(data.dir,"2017decoder.csv"))
# set up the headers for most.recent structure - will contain oldest Assessment.Year
most.recent <- dat[1,]
most.recent <- most.recent[-1,]

for (i in 1:n.stocks){
  temp <- dat[dat$Entity.Name == decoder$Entity.Name[i],]
  most.recent <- rbind(most.recent,temp[temp$Assessment.Year == max(temp$Assessment.Year),])
}
#cbind(n.stocks,length(most.recent[,1]))

# get the max of F.Flimit and F.Fmsy and the max of B.Blimit and B.Bmsy
Frat <- most.recent$F.Fmsy
Brat <- most.recent$B.Bmsy
#Frat[6] <- most.recent$F.Flimit[6]  # Ocean Quahog use Flimit because no Fmsy
#Frat[18] <- 0.88  # hardwire average of the two GOM models for GOM cod
#Brat[18] <- 0.155 # hardwire average of the two GOM models for GOM cod
#model averages have been calculated and included in F/Fmsy column in 2017assess.csv
#cbind(most.recent$Entity.Name,most.recent$F.Flimit,most.recent$F.Fmsy)

# figure out appropriate range for axes WARNING HARD CODED
#max(Frat,na.rm=T)
#max(Brat,na.rm=T)
x.r <- c(0,3)
y.r <- c(0,3)

# set some colors
my.col <- rep(NA,n.stocks)
MA.col <- "blue"
NE.col <- "blue"
BO.col <- "purple"
for (i in 1:n.stocks){
  if(decoder$Council[i] == "MAFMC") my.col[i] <- MA.col
  if(decoder$Council[i] == "NEFMC") my.col[i] <- NE.col
  if(decoder$Council[i] == "Both")  my.col[i] <- BO.col
}

# create new matrix for plotting
xx <- as.data.frame(cbind(decoder[,2:8],Frat,Brat,my.col))
newlist <- as.factor(decoder$Code)
others <- as.factor(c("7 Skates", "B. Tilefish"))
sppcodes <- unlist(list(newlist, others))
MA.unknown <- sppcodes[c(51,3,4,47,48)] #mackerel, Loligo, Illex, monkfish unknown
#MA.unknown <- decoder$Code[c(1,3,4,8)] #BSB known
#NE.unknown <- c(decoder$Code[c(14,23,33)],"7 Skates")
NE.overfished <- sppcodes[c(17,19)] # GB cod, halibut
NE.unknown <- sppcodes[c(14,23,33,35,37,47,48,50)] #Red deepsea crab,  Offshore hake, GOM winter flounder, Witch flounder, GB YT,2 monkfish, 7 skates unknown


# break out the Councils
MA <- xx[xx$Council == "MAFMC",]
NE <- xx[xx$Council == "NEFMC",]
BO <- xx[xx$Council == "Both",]
MABO<-rbind(MA, BO)
NEBO<-rbind(NE, BO)

#if(saveplots) png(file = "MAFMC_joint_stocks_2017.png",  units="in", width = 6, height = 6, res=1200)
plot(MABO$Brat,MABO$Frat,xlim=x.r,ylim=y.r,xlab="B/Bmsy",ylab="F/Fmsy",pch=16,col=my.col[c(1:11,47:49)])
  abline(v=0.5,lty=2)
  abline(v=1,lty=3)
  abline(h=1,lty=2)
  title(expression("MAFMC " * phantom("and Joint Stocks")), col.main="blue")
  title(expression(phantom("MAFMC ") * "and " * phantom("Joint Stocks")), col.main="black")
  title(expression(phantom("MAFMC and ") * "Joint" * phantom(" Stocks")), col.main="purple")
  title(expression(phantom("MAFMC and Joint") * " Stocks"), col.main="black")  
  legend('topright',legend=MA.unknown,pch=NA,text.col=my.col[c(1,3,4,47,48)], title="Unknown Status", title.col = "black")
  text(MABO$Brat,MABO$Frat,labels=MABO$Code,pos=MABO$my.pos3,col=my.col[c(1:11,47:49)],cex=0.8)
#if(saveplots) savePlot("MAFMC_Joint_stocks.png", type='png')
#if(saveplots) dev.off()

#if(saveplots) pdf(file = "NEFMC_joint_stocks.pdf",  width = 6, height = 6)
#if(saveplots) png(file = "NEFMC_joint_stocks.png",  units="in", width = 6, height = 9, res=1200)
# plot(NEBO$Brat,NEBO$Frat,xlim=x.r,ylim=y.r,xlab="B/Bmsy",ylab="F/Fmsy",pch=16,col=my.col[12:49])
#    abline(v=0.5,lty=2)
#    abline(v=1,lty=3)
#    abline(h=1,lty=2)
#    title(expression("NEFMC " * phantom("and Joint Stocks")), col.main="blue")
#    title(expression(phantom("NEFMC ") * "and " * phantom("Joint Stocks")), col.main="black")
#    title(expression(phantom("NEFMC and ") * "Joint" * phantom(" Stocks")), col.main="purple")
#    title(expression(phantom("NEFMC and Joint") * " Stocks"), col.main="black")  
#    legend('topright',legend=NE.overfished,pch=NA,title="Overfished, F \nStatus Unknown",bty="n", text.width=strwidth("Offshore Hake"), inset=c(0,.05))
#    legend('right',legend=NE.unknown,pch=NA,title="Unknown Status", bty="n")
#    text(NEBO$Brat,NEBO$Frat,labels=NEBO$Code,pos=NEBO$my.pos3,col=my.col[12:49],cex=0.8)
#if(saveplots) savePlot("NEFMC_Joint_stocks.png", type='png')
#if(saveplots) dev.off()

```

\newpage

```{r seafoodlandingsMAB, fig.cap="Mid Atlantic seafood production indicators. A: Mid-Atlantic Council managed seafood landings (red) and total commercial landings (black) by feeding guild. B: Mid Atlantic Council managed seafood landings (red) and total commercial landings (black) summed across guilds. C: Total recreational harvest in the Mid Atlantic.",echo = F, warning = F, include = T, fig.align='center', fig.keep='last'}

## Figure dimensions
figureX <- multi_panel_figure(
   columns = 2,
   rows = 2)

## Ecosystem-wide and managed species total landings by feeding guild
## A: Apex predators, B: Piscivore, C: Planktivore, D: Benthivore, E: Benthos
guildland <- capture_base_plot({
  opar <- par(mfrow = c(5, 1), mar = c(0, 0, 0, 0), oma = c(3, 3.5, 1, 1))
  
  soe.plot(SOE.data.2018, "Time","Apex Predator Landings MAB", stacked = "Apex predators",status = F,
           endshade = T, rel.y.num = 0.6, full.trend = T, scale.axis = 1,end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 )
  
  soe.plot(SOE.data.2018, "Time", "Piscivore Landings MAB", stacked = "Piscivores",status = F,
           endshade = T, rel.y.num = 0.6, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
           y.var2 = "Piscivore MAFMC managed species sea food MAB")
  
  soe.plot(SOE.data.2018, "Time", "Planktivore Landings MAB", stacked = "Planktivores",status = F,
           endshade = T, rel.y.num = 0.6, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
           y.var2 = "Planktivore MAFMC managed species sea food MAB")
  
  soe.plot(SOE.data.2018, "Time", "Benthivore Landings MAB", stacked = "Benthivores",status = F,
           endshade = T, rel.y.num = 0.6, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
           y.var2 = "Benthivore MAFMC managed species sea food MAB")
  
  soe.plot(SOE.data.2018, "Time", "Benthos Landings MAB", stacked = "Benthos",status = F,
           endshade = T, rel.y.num = 0.6, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
           y.var2 = "Benthos MAFMC managed species sea food MAB")
  
  soe.stacked.axis("Year", expression("Landings, 10"^3*" tons"), x.line = 2, 
                   rel.x.text = 0.8, y.line=2, rel.y.text = 0.8)
})

## Fill the panels
figureX <- fill_panel(figureX, guildland, row = 1:2, column = 1)

## Ecosystem-wide and managed species total landings
totland <- capture_base_plot({
  opar <- par(mfrow = c(1, 1), mar = c (2, 2, 0, 0), oma = c(4, 2.5, 1.8, 1))
  
  soe.plot(SOE.data.2018, "Time", "Total Landings MAB", point.cex = 1, rel.y.text = 0.8, 
           rel.y.num = 0.6, scale.axis = 10^3, end.start = 2007, x.start = 1986,
           ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
           y.var2 = "Total managed landings MAB", x.label = 'Year', y.line = 2,
           rel.x.text = 0.8, rel.x.num = 0.6, x.line = 2,
           y.label = expression('Landings, 10'^3 * ' tons'))
  
})

figureX <- fill_panel(figureX, totland, row = 1, column = 2)

## Recreational landings
recland <-capture_base_plot({
  #opar <- par(mfrow = c(1, 1))
  soe.plot(SOE.data.2018, "Time", "Recreational Seafood MA", point.cex = 1, scale.axis = 10^6,
           end.start = 2008, x.label = 'Year', rel.y.text = 0.8, rel.y.num = 0.6, y.line = 2,
           rel.x.text = 0.8, rel.x.num = 0.6, x.line = 2,
           y.label = expression("Fish caught, 10"^6 *" n"))
})

figureX <- fill_panel(figureX, recland, row = 2, column = 2)

figureX
```


```{r seafoodlandingsGOM,  fig.cap = "Total landings (black) and total seafood specific landings managed by NEFMC (red) in Gulf of Maine (left) and Georges Bank (right) (A: Apex predators, B: Piscivore, C: Planktivore, D: Benthivore, E: Benthos).", echo = F, fig.show='hold', fig.align='default',out.width='.49\\linewidth',warning = F, message = F}
#fig.height = 5.5,
## Gulf of Maine cosystem-wide and managed species total landings
opar <- par(mfrow = c(5, 1), mar = c(0, 0, 0, 0), oma = c(4, 6.5, 2, 6))

soe.plot(SOE.data.2018, "Time","Apex Predator Landings GOM", stacked = "A",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0, cex.stacked = 2)

soe.plot(SOE.data.2018, "Time", "Piscivore Landings GOM", stacked = "B",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Piscivore NEFMC managed species sea food GOM", mean_line = T, cex.stacked = 2)


soe.plot(SOE.data.2018, "Time", "Planktivore Landings GOM", stacked = "C",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 ="Planktivore NEFMC managed species sea food GOM", mean_line = T, cex.stacked = 2)
soe.plot(SOE.data.2018, "Time", "Benthivore Landings GOM", stacked = "D",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Benthivore NEFMC managed species sea food GOM", mean_line = T, cex.stacked = 2)
soe.plot(SOE.data.2018, "Time", "Benthos Landings GOM", stacked = "E",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Benthos NEFMC managed species sea food GOM", mean_line = T, cex.stacked = 2)
soe.stacked.axis("Time",expression("Landings, 10"^3*"metric tons"), outer = T)

## Goerges Bank ecosystem-wide and managed species total landings
opar <- par(mfrow = c(5, 1), mar = c(0, 0, 0, 0), oma = c(4, 6.5, 2, 6))

soe.plot(SOE.data.2018, "Time","Apex Predator Landings GB", stacked = "A",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0, cex.stacked = 2)

soe.plot(SOE.data.2018, "Time", "Piscivore Landings GB", stacked = "B",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Piscivore NEFMC managed species sea food GB", mean_line = T, cex.stacked = 2)


soe.plot(SOE.data.2018, "Time", "Planktivore Landings GB", stacked = "C",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 ="Planktivore NEFMC managed species sea food GB", mean_line = T, cex.stacked = 2)
soe.plot(SOE.data.2018, "Time", "Benthivore Landings GB", stacked = "D",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Benthivore NEFMC managed species sea food GB", mean_line = T, cex.stacked = 2)
soe.plot(SOE.data.2018, "Time", "Benthos Landings GB", stacked = "E",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 = "Benthos NEFMC managed species sea food GB", mean_line = T, cex.stacked = 2)
soe.stacked.axis("Time",expression("Landings, 10"^3*"metric tons"), outer = T)

```


 
```{r managedlandingsNE, fig.cap = "Total landings (black) and total landings managed by NEFMC (red) in Gulf of Maine (A) and Georges Bank (B).", echo=F, message=FALSE, warning=FALSE , fig.asp=.5, fig.align = 'center'}
opar <- par(mfrow = c(2, 1), mar = c(0, 0, 0, 0), oma = c(4, 6, 2, 6))

soe.plot(SOE.data.2018, "Time", "Total Landings GOM", stacked = "A",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 =  "Total managed landings GOM")
soe.plot(SOE.data.2018, "Time", "Total Landings GB", stacked = "B",status = F,
         endshade = T, rel.y.num = 1.1, full.trend = T, scale.axis = 10^3,end.start = 2007, x.start = 1964,
         ymin = FALSE, y.lower = 0 , extra = TRUE, x.var2 = "Time", 
         y.var2 =  "Total managed landings GB")
soe.stacked.axis("Time",expression("Landings, 10"^3*"metric tons"), outer = T, rel.x.text = 1.2, rel.y.text = 1.2)
```



```{r reccatchNE, fig.cap = "Recreational seafood landings in New England.",echo = F, message=F, include=T, warning=F,fig.asp = 0.45, fig.align = 'center'}
opar <- par(mar = c(4, 6, 2, 6))

soe.plot(SOE.data.2018, "Time", "Recreational Seafood NE", stacked = NA, status = F, full.trend = T,
         scale.axis = 10^6,end.start = 2007, suppressAxis = T)
soe.stacked.axis("Time",expression("Fish caught, 10"^6*" n"), outer = F, rel.x.text = 1.2, rel.y.text = 1.2)

```

